# Docker Compose configuration for portableralph testing
# Usage:
#   1. Copy .env.docker.example to .env.docker and fill in your API keys
#   2. Run: docker-compose up -d
#   3. Connect: docker-compose exec ralphcontainer bash
#   4. Stop: docker-compose down

services:
  ralphcontainer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ralphcontainer

    # Load environment variables from .env.docker
    env_file:
      - .env.docker

    # Mount the repo as a volume for live development
    volumes:
      - .:/home/ralphuser/portableralph:rw
      # Persist Ralph configuration between runs
      - ralph-config:/home/ralphuser/.config
      - ralph-data:/home/ralphuser/.ralph
      # Persist Claude Code configuration
      - ralph-claude:/home/ralphuser/.claude
      # Test workspace
      - ralph-workspace:/home/ralphuser/test-workspace

    # Additional environment variables (non-sensitive defaults)
    environment:
      - TERM=xterm-256color
      - HOME=/home/ralphuser
      - RALPH_CONFIG_DIR=/home/ralphuser/.ralph

    # Keep container running for interactive use
    stdin_open: true
    tty: true

    # Allow access to host network for OpenRouter whitelist proxy
    extra_hosts:
      - "host.docker.internal:host-gateway"

    # Resource limits
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '4'

# Named volumes for persistent data
volumes:
  ralph-config:
    name: portableralph-config
  ralph-data:
    name: portableralph-data
  ralph-claude:
    name: portableralph-claude
  ralph-workspace:
    name: portableralph-workspace
